<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S&R Pro Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="lightweight-charts.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0b0e11;
            color: #eaecef;
        }

        .glass {
            background: rgba(23, 27, 34, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .text-up {
            color: #00c076;
        }

        .text-down {
            color: #f6465d;
        }

        .bg-up {
            background-color: rgba(0, 192, 118, 0.1);
        }

        .bg-down {
            background-color: rgba(246, 70, 93, 0.1);
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #0b0e11;
        }

        ::-webkit-scrollbar-thumb {
            background: #2b3139;
            border-radius: 10px;
        }

        #rotation-tooltip {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            padding: 12px;
            border-radius: 12px;
            font-size: 11px;
            min-width: 150px;
            display: none;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hud-alert {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid rgba(59, 130, 246, 0.5);
            color: #3b82f6;
            font-weight: bold;
            font-size: 12px;
            z-index: 50;
            display: none;
            animation: slideDownIn 0.3s ease-out, fadeOut 2s 1s forwards;
        }

        @keyframes slideDownIn {
            from {
                transform: translate(-50%, -100%);
                opacity: 0;
            }

            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
            }
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #1e293b;
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #334155;
        }

        .border-l-up {
            border-left-color: #00c076;
        }

        .border-l-down {
            border-left-color: #f6465d;
        }

        /* Signal Modal Styles */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
        }

        .signal-modal {
            max-width: 600px;
            width: 90%;
            background: #131722;
            border: 1px solid #1e222d;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
        }

        .strategy-card {
            transition: all 0.3s ease;
        }

        .hidden-strategy {
            display: none !important;
        }
    </style>
</head>

<body class="min-h-screen overflow-x-hidden">
    <!-- Header -->
    <header class="h-16 border-b border-gray-800 glass sticky top-0 z-50 px-6 flex items-center justify-between">
        <div class="flex flex-wrap items-center gap-3 justify-between md:justify-end">
            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center font-bold text-white">S</div>
            <div class="flex flex-col -space-y-1">
                <h1 class="text-xl font-bold tracking-tight">S&R <span class="text-blue-500">PRO</span> <span
                        id="ver-tag" class="text-[8px] text-gray-600 ml-1 font-mono">v1.4.3</span></h1>
                <p id="sync-time" class="text-[9px] text-gray-500 font-mono italic">Last updated: --:--:--</p>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <!-- Screener Toggle -->
            <div class="flex items-center space-x-3 bg-gray-900 px-3 py-1.5 rounded-xl border border-gray-800">
                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Screener</span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="screener-toggle" class="sr-only peer">
                    <div
                        class="w-9 h-5 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-indigo-600">
                    </div>
                </label>
            </div>

            <!-- Rotation Toggle -->
            <div class="flex items-center space-x-3 bg-gray-900 px-3 py-1.5 rounded-xl border border-gray-800">
                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Rotation</span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="rotation-toggle" class="sr-only peer">
                    <div
                        class="w-9 h-5 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600">
                    </div>
                </label>
            </div>

            <!-- View Mode Toggle -->
            <div class="flex items-center space-x-2 bg-gray-900 px-2 py-1 rounded-xl border border-gray-700">
                <button id="view-dashboard"
                    class="px-3 py-1 text-[10px] font-bold uppercase tracking-widest rounded-md bg-blue-600 text-white transition-colors">
                    Dashboard
                </button>
                <button id="view-intelligence"
                    class="px-3 py-1 text-[10px] font-bold uppercase tracking-widest rounded-md text-gray-400 hover:bg-gray-800 transition-colors">
                    Intelligence
                </button>
            </div>

            <!-- Search Box (Relative for Dropdown) -->
            <div class="relative">
                <div class="flex items-center space-x-3 bg-gray-900 px-3 py-1.5 rounded-xl border border-gray-800">
                    <input type="text" id="symbol-input" value="RELIANCE"
                        class="bg-transparent border-none text-sm font-semibold text-white focus:outline-none w-24 uppercase placeholder-gray-500"
                        placeholder="SYMBOL">
                    <button id="search-btn" class="ml-1 text-gray-400 hover:text-white transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </button>
                </div>
                <!-- Autocomplete Results -->
                <div id="search-results"
                    class="absolute top-full left-0 mt-2 w-64 glass rounded-xl border border-gray-700 hidden overflow-hidden z-50 shadow-xl max-h-60 overflow-y-auto">
                    <!-- Dynamic Items -->
                </div>
            </div>
            <div class="flex items-center gap-2 bg-[#1e2329] border border-gray-700 rounded-lg px-3 py-1">
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="mtf-toggle" class="sr-only peer" checked>
                    <div
                        class="w-7 h-4 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-blue-600">
                    </div>
                    <span class="ml-2 text-[10px] font-bold text-gray-400 uppercase tracking-tighter">MTF</span>
                </label>
            </div>
            <!-- Intraday Intelligence Timeframe Chips -->
            <div id="intraday-tf-toggle"
                class="hidden md:flex items-center gap-1 bg-[#111827] border border-gray-700 rounded-lg px-1 py-0.5">
                <button data-tf="5m"
                    class="px-2.5 py-0.5 text-[10px] font-bold uppercase tracking-widest rounded-md bg-blue-600 text-white shadow-[0_0_8px_rgba(37,99,235,0.7)]">
                    5 MIN
                </button>
                <button data-tf="15m"
                    class="px-2.5 py-0.5 text-[10px] font-bold uppercase tracking-widest rounded-md text-gray-300 hover:bg-gray-800 transition-colors">
                    15 MIN
                </button>
            </div>
            <select id="strategy-selector"
                class="bg-blue-900/40 border border-blue-500/50 rounded-lg px-2 py-1 text-xs md:text-sm font-bold focus:ring-1 focus:ring-blue-500 cursor-pointer text-blue-100 uppercase tracking-tighter">
                <option value="SR">Support/Resistance (SR)</option>
                <option value="SWING">Swing Trading</option>
                <option value="DEMAND_SUPPLY">Demand/Supply Zones</option>
            </select>
            <select id="tf-selector"
                class="bg-[#1e2329] border border-gray-700 rounded-lg px-2 py-1 text-xs md:text-sm font-medium focus:ring-1 focus:ring-blue-500 cursor-pointer text-white">
                <option value="5m">5 min</option>
                <option value="15m">15 min</option>
                <option value="75m">75 min</option>
                <option value="1H">1 hour</option>
                <option value="2H">2 hour</option>
                <option value="4H">4 hour</option>
                <option value="1D" selected>Daily</option>
                <option value="1W">Weekly</option>
                <option value="1M">Monthly</option>
            </select>
            <button class="glass p-2 rounded-full hover:bg-gray-800 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <main id="dashboard-main" class="p-6 max-w-[1600px] mx-auto space-y-6 transition-all duration-500">
        <!-- Strategy Screener Results -->
        <div id="screener-panel"
            class="hidden border border-indigo-900 bg-indigo-950/20 rounded-2xl p-4 animate-in slide-in-from-top duration-300">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 bg-indigo-400 rounded-full animate-pulse"></div>
                    <h2 class="text-xs font-bold uppercase tracking-widest text-indigo-400">Quarterly Growth Screener
                        Results</h2>
                </div>
                <span id="screener-count"
                    class="text-[10px] bg-indigo-600 text-white px-2 py-0.5 rounded-full font-bold uppercase">Scanning...</span>
            </div>
            <div id="screener-list" class="flex gap-4 overflow-x-auto pb-2 custom-scrollbar">
                <!-- Cards will be injected here -->
                <p class="text-xs text-gray-500 italic">Evaluating Nifty 10 stocks based on your 9-point criteria...</p>
            </div>
        </div>

        <!-- Market Intelligence Section -->
        <section id="intelligence-section" class="hidden animate-in">
            <div class="grid grid-cols-12 gap-6">
                <!-- Left: Hits & Sectors Table (7 cols) -->
                <div class="col-span-12 lg:col-span-7 space-y-6">
                    <!-- Today's Market Summary Block -->
                    <div id="market-summary-block"
                        class="glass rounded-2xl overflow-hidden border border-indigo-500/30 animate-in slide-in-from-top duration-500 hidden">
                        <div
                            class="px-4 py-3 bg-indigo-900/20 border-b border-gray-800 flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="flex items-center gap-2">
                                    <span class="text-xl">üß†</span>
                                    <h2 id="market-summary-title"
                                        class="text-[11px] font-bold uppercase tracking-widest text-indigo-100">AI
                                        Market Summary</h2>
                                </div>
                                <div class="flex bg-black/40 p-0.5 rounded-lg border border-gray-800">
                                    <button id="summary-mode-morning"
                                        onclick="window.intelligenceApp.setSummaryMode('morning')"
                                        class="px-2 py-1 text-[9px] rounded-md transition-all text-gray-400 hover:text-white">Morning</button>
                                    <button id="summary-mode-evening"
                                        onclick="window.intelligenceApp.setSummaryMode('evening')"
                                        class="px-2 py-1 text-[9px] rounded-md transition-all text-gray-400 hover:text-white">Wrap</button>
                                    <button id="summary-mode-outlook"
                                        onclick="window.intelligenceApp.setSummaryMode('outlook')"
                                        class="px-2 py-1 text-[9px] rounded-md transition-all text-gray-400 hover:text-white">Outlook</button>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <button onclick="window.intelligenceApp.copySummaryToClipboard()"
                                    class="p-1.5 hover:bg-white/10 rounded-md transition-colors group"
                                    title="Copy for WhatsApp/Telegram">
                                    <svg class="w-3.5 h-3.5 text-gray-400 group-hover:text-indigo-400"
                                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                    </svg>
                                </button>
                                <span class="text-[8px] text-indigo-400/60 font-mono">v1.1</span>
                            </div>
                        </div>
                        <div class="p-5">
                            <div id="market-summary-text" class="text-xs text-gray-300 leading-relaxed italic">
                                Calibrating latest market movements for summary generation...
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-2xl overflow-hidden border border-gray-800">
                        <div class="p-4 border-b border-gray-800 flex justify-between items-center bg-gray-900/50">
                            <div>
                                <h2 class="text-sm font-bold uppercase tracking-widest text-indigo-400">Momentum
                                    Hits (1D/2D/3D)</h2>
                                <p class="text-[10px] text-gray-500">Price > 2% | Vol > 1.5x | Consecutive Momentum
                                </p>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="flex items-center gap-2">
                                    <span
                                        class="text-[9px] font-bold text-gray-500 uppercase tracking-widest">Filter:</span>
                                    <select id="confidence-filter" onchange="window.intelligenceApp._renderHitsTable()"
                                        class="bg-gray-800 border border-gray-700 text-[9px] font-bold text-indigo-400 rounded px-2 py-1 focus:ring-1 focus:ring-indigo-500 outline-none uppercase cursor-pointer">
                                        <option value="40">40% (Early)</option>
                                        <option value="60" selected>60% (Reliable)</option>
                                        <option value="80">80% (Strongest)</option>
                                    </select>
                                </div>
                                <div id="hits-sync-status"
                                    class="flex items-center gap-1.5 text-[9px] text-gray-500 font-mono">
                                    <span class="w-1.5 h-1.5 bg-indigo-500 rounded-full animate-pulse"></span>
                                    LIVE SYNC
                                </div>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-[11px]">
                                <thead class="bg-gray-900/80 text-gray-500 uppercase tracking-tighter">
                                    <tr>
                                        <th class="px-4 py-3 font-bold">Symbol</th>
                                        <th class="px-4 py-3 font-bold text-right">Price</th>
                                        <th class="px-4 py-3 font-bold text-right">Chg%</th>
                                        <th class="px-4 py-3 text-center">Momentum</th>
                                        <th class="px-4 py-3">Status</th>
                                        <th class="px-4 py-3 text-center">Confidence</th>
                                        <th class="px-4 py-3">Risk</th>
                                        <th class="px-4 py-3 text-center">RU</th>
                                        <th class="px-4 py-3">Session</th>
                                        <th class="px-4 py-3 text-right">Vol</th>
                                        <th class="px-4 py-3 text-right">Sector</th>
                                    </tr>
                                </thead>
                                <tbody id="momentum-hits-body" class="divide-y divide-gray-800/50">
                                    <tr>
                                        <td colspan="6" class="px-4 py-10 text-center text-gray-500 italic">Scanning
                                            market for momentum hits...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Right: Sector Insight Cards (5 cols) -->
                <div class="col-span-12 lg:col-span-5 space-y-4">
                    <div class="flex items-center justify-between px-2">
                        <h2 class="text-[11px] font-bold uppercase tracking-widest text-blue-400">Sector
                            Intelligence</h2>
                        <span class="text-[9px] text-gray-500 italic">Sorted by Momentum Score</span>
                    </div>
                    <div id="sector-intelligence-list"
                        class="space-y-4 max-h-[700px] overflow-y-auto pr-2 custom-scrollbar">
                        <div
                            class="glass p-8 rounded-2xl flex flex-col items-center justify-center text-center opacity-50">
                            <div
                                class="w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-4">
                            </div>
                            <p class="text-xs text-blue-400 font-mono italic">CALCULATING SHIFT METRICS...</p>
                        </div>
                    </div>

                    <div id="ai-detail-panel"
                        class="glass rounded-2xl overflow-hidden border border-indigo-500/30 flex flex-col hidden animate-in slide-in-from-left duration-300">
                        <div
                            class="px-4 py-3 border-b border-gray-800 bg-indigo-900/20 flex justify-between items-center">
                            <h3 id="ai-detail-title" class="text-[10px] font-bold uppercase tracking-widest text-white">
                                Sector Analysis</h3>
                            <button onclick="document.getElementById('ai-detail-panel').classList.add('hidden')"
                                class="text-gray-500 hover:text-white">&times;</button>
                        </div>
                        <div class="p-4">
                            <div id="ai-detail-rank" class="text-[9px] font-bold text-indigo-400 uppercase mb-2">#1
                                Overall Strength</div>
                            <p id="ai-detail-text" class="text-xs text-gray-300 leading-relaxed italic">Click AI VIEW on
                                a sector card to read commentary.</p>
                        </div>
                        <div class="px-4 py-2 bg-gray-900/40 border-t border-gray-800 flex justify-between">
                            <span class="text-[8px] text-gray-500">AI AGENTIC INSIGHT</span>
                            <span class="text-[8px] text-indigo-400 font-bold uppercase">Decision Support</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Rotation Dashboard Section -->
        <section id="rotation-section" class="hidden animate-in">
            <div class="grid grid-cols-1 gap-6">
                <div class="card p-0 overflow-hidden relative" style="height: 700px;">
                    <div class="absolute top-6 left-6 z-10">
                        <h2 class="text-xl font-bold">Sector Rotation <span class="text-blue-500">Live</span></h2>
                        <p class="text-xs text-gray-500">Relative Strength vs Momentum</p>
                    </div>

                    <div id="rotation-tooltip" class="glass"></div>
                    <div id="hud-alert" class="hud-alert"></div>

                    <div class="absolute top-6 right-6 z-10 flex items-center space-x-4">
                        <div
                            class="bg-gray-900/80 backdrop-blur border border-gray-700 p-2 rounded-lg flex items-center space-x-4">
                            <span class="text-[10px] font-bold uppercase text-gray-500">Playback</span>
                            <input type="range" id="playback-slider" min="0" max="29" value="29"
                                class="w-32 h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                            <span id="playback-date" class="text-[10px] font-mono text-white min-w-[70px]">Today</span>
                        </div>
                        <button onclick="zoomReset()"
                            class="p-2 bg-gray-900/80 border border-gray-700 rounded-lg text-gray-400 hover:text-white">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4">
                                </path>
                            </svg>
                        </button>
                    </div>

                    <canvas id="rotation-canvas" class="w-full h-full cursor-grab"></canvas>

                    <!-- Alert Log Sidebar -->
                    <div id="alert-log-panel"
                        class="absolute top-24 right-6 w-64 glass rounded-2xl overflow-hidden border border-gray-800 flex flex-col max-h-[400px]">
                        <div
                            class="px-4 py-3 border-b border-gray-800 bg-gray-900/50 flex justify-between items-center">
                            <h3 class="text-[10px] font-bold uppercase tracking-widest text-indigo-400">Rotation
                                Alerts</h3>
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        </div>
                        <div id="alert-list" class="flex-grow overflow-y-auto p-2 space-y-2">
                            <p class="text-[10px] text-gray-500 italic text-center py-4">Waiting for transitions...
                            </p>
                        </div>
                    </div>

                    <!-- Legends -->
                    <div class="absolute bottom-6 left-6 grid grid-cols-2 gap-2 text-[9px] font-bold">
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 rounded-full bg-[#00C853]"></div><span
                                class="text-green-500 tracking-widest uppercase">LEADING</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 rounded-full bg-[#FFD600]"></div><span
                                class="text-yellow-500 tracking-widest uppercase">WEAKENING</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 rounded-full bg-[#D50000]"></div><span
                                class="text-red-500 tracking-widest uppercase">LAGGING</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 rounded-full bg-[#2979FF]"></div><span
                                class="text-blue-500 tracking-widest uppercase">IMPROVING</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Standard Dashboard View -->
        <div id="standard-dashboard">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4" id="summary-container">
                <!-- Cards same as before... -->
                <div class="glass p-4 rounded-2xl">
                    <p
                        class="text-gray-400 text-xs font-medium uppercase tracking-wider mb-1 flex justify-between items-center">
                        Price
                        <span id="live-indicator" class="flex items-center gap-1 text-[9px] text-blue-400 font-bold">
                            <span class="w-1.5 h-1.5 bg-blue-500 rounded-full animate-pulse"></span> LIVE
                        </span>
                    </p>
                    <div class="flex items-baseline gap-2">
                        <span id="cmp" class="text-2xl font-bold mono">‚Äî</span>
                        <span id="price-change" class="text-xs font-medium">+0.00%</span>
                    </div>
                </div>
                <div class="glass p-4 rounded-2xl border-l-4 border-l-blue-500">
                    <p class="text-gray-400 text-xs font-medium uppercase tracking-wider mb-1">Nearest Support</p>
                    <span id="nearest-support" class="text-2xl font-bold mono text-blue-400">‚Äî</span>
                </div>
                <div class="glass p-4 rounded-2xl border-l-4 border-l-green-500">
                    <p class="text-gray-400 text-xs font-medium uppercase tracking-wider mb-1">Nearest Resistance</p>
                    <span id="nearest-resistance" class="text-2xl font-bold mono text-green-400">‚Äî</span>
                </div>
                <div class="glass p-4 rounded-2xl border-l-4 border-l-orange-500">
                    <p class="text-gray-400 text-xs font-medium uppercase tracking-wider mb-1">Logical SL</p>
                    <span id="stop-loss" class="text-2xl font-bold mono text-orange-400">‚Äî</span>
                </div>
                <div class="glass p-4 rounded-2xl border-l-4 border-l-purple-500">
                    <p class="text-gray-400 text-xs font-medium uppercase tracking-wider mb-1">Risk Reward</p>
                    <div class="flex items-center gap-2">
                        <span id="risk-reward" class="text-2xl font-bold mono text-purple-400">‚Äî</span>
                        <span id="trade-signal"
                            class="px-2 py-0.5 rounded-full text-[10px] font-bold tracking-wider bg-gray-800 text-gray-400">HOLD</span>
                    </div>
                    <p id="trade-signal-reason" class="text-[10px] text-gray-500 mt-1">Signal updates with EMA bias +
                        structure.</p>
                </div>
            </div>

            <!-- Strategy Specific Metrics (Dynamic) -->
            <div id="strategy-sr-metrics" class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-6 strategy-card">
                <div class="glass p-4 rounded-2xl border-l-4 border-l-indigo-500">
                    <p class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-1">ADX Strength</p>
                    <div class="flex items-baseline gap-2">
                        <span id="sr-adx" class="text-2xl font-bold mono text-indigo-400">‚Äî</span>
                        <span id="sr-adx-label" class="text-[10px] font-bold text-gray-500">TREND</span>
                    </div>
                </div>
                <div class="glass p-4 rounded-2xl border-l-4 border-l-indigo-500">
                    <p class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-1">Volume Ratio</p>
                    <span id="sr-vol" class="text-2xl font-bold mono text-indigo-400">‚Äî</span>
                </div>
                <div class="glass p-4 rounded-2xl border-l-4 border-l-indigo-500">
                    <p class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-1">Breakout</p>
                    <span id="sr-breakout" class="text-lg font-bold uppercase tracking-widest text-white">‚Äî</span>
                </div>
                <div class="glass p-4 rounded-2xl border-l-4 border-l-indigo-500">
                    <p class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-1">Retest</p>
                    <span id="sr-retest" class="text-lg font-bold uppercase tracking-widest text-white">‚Äî</span>
                </div>
            </div>

            <div id="strategy-swing-metrics"
                class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-6 strategy-card hidden-strategy">
                <div class="glass p-4 rounded-2xl border-l-4 border-l-purple-500">
                    <p class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-1">Structural Bias</p>
                    <span id="swing-structure"
                        class="text-lg font-bold uppercase tracking-widest text-purple-400">‚Äî</span>
                </div>
                <div class="glass p-4 rounded-2xl border-l-4 border-l-purple-500">
                    <p class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-1">EMA Alignment</p>
                    <span id="swing-ema" class="text-lg font-bold uppercase tracking-widest text-white">‚Äî</span>
                </div>
                <div class="glass p-4 rounded-2xl border-l-4 border-l-purple-500">
                    <p class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-1">4H Trend</p>
                    <span id="swing-htf" class="text-lg font-bold uppercase tracking-widest text-white">‚Äî</span>
                </div>
                <div class="glass p-4 rounded-2xl border-l-4 border-l-purple-500">
                    <p class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-1">Pullback</p>
                    <span id="swing-pullback" class="text-lg font-bold uppercase tracking-widest text-white">‚Äî</span>
                </div>
            </div>

            <div id="strategy-zones-metrics"
                class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-6 strategy-card hidden-strategy">
                <div class="glass p-4 rounded-2xl border-l-4 border-l-yellow-500">
                    <p class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-1">Zone Freshness</p>
                    <span id="zone-freshness"
                        class="text-lg font-bold uppercase tracking-widest text-yellow-400">‚Äî</span>
                </div>
                <div class="glass p-4 rounded-2xl border-l-4 border-l-yellow-500">
                    <p class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-1">Departure</p>
                    <span id="zone-departure" class="text-2xl font-bold mono text-white">‚Äî</span>
                </div>
                <div class="glass p-4 rounded-2xl border-l-4 border-l-yellow-500">
                    <p class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-1">Zone Range</p>
                    <span id="zone-range" class="text-[10px] font-bold text-gray-300">‚Äî</span>
                </div>
                <div class="glass p-4 rounded-2xl border-l-4 border-l-yellow-500">
                    <p class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-1">Vol Spike</p>
                    <span id="zone-vol" class="text-lg font-bold uppercase tracking-widest text-white">‚Äî</span>
                </div>
            </div>

            <!-- Middle Section -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">
                <!-- Chart Section -->
                <div class="col-span-2 space-y-6">
                    <div class="glass rounded-2xl overflow-hidden p-2 relative" style="height: 500px;"
                        id="chart-parent">
                        <div id="tv-chart" class="w-full h-full"></div>
                    </div>

                    <!-- Price Action Insights -->
                    <div class="glass rounded-2xl overflow-hidden">
                        <div class="p-4 border-b border-gray-800 flex justify-between items-center">
                            <h3 class="font-bold text-sm">Price Action Insights</h3>
                            <span id="bias-badge"
                                class="px-3 py-1 rounded-full text-xs font-bold uppercase tracking-widest bg-gray-800">Neutral</span>
                        </div>
                        <div class="grid grid-cols-3 divide-x divide-gray-800 text-center p-6">
                            <div>
                                <p class="text-gray-400 text-[10px] uppercase mb-1 font-bold">Inside Candle</p>
                                <p id="inside-candle" class="text-lg font-bold">‚Äî</p>
                            </div>
                            <div>
                                <p class="text-gray-400 text-[10px] uppercase mb-1 font-bold">Level Retest</p>
                                <p id="retest" class="text-lg font-bold">‚Äî</p>
                            </div>
                            <div>
                                <p class="text-gray-400 text-[10px] uppercase mb-1 font-bold">Upside Target</p>
                                <p id="upside-pct" class="text-lg font-bold text-up">‚Äî</p>
                            </div>
                        </div>
                    </div>

                    <!-- AI Insights -->
                    <div class="glass rounded-2xl overflow-hidden border border-indigo-500/20">
                        <div class="p-4 border-b border-gray-800 flex justify-between items-center bg-indigo-500/5">
                            <h3 class="font-bold text-xs tracking-tight text-indigo-100 uppercase italic">AI Strategic
                                Context</h3>
                            <span id="ai-priority-badge"
                                class="px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-widest bg-gray-800 text-gray-500">PRIORITY:
                                ‚Äî</span>
                        </div>
                        <div class="grid grid-cols-2 divide-x divide-gray-800">
                            <div class="p-5 space-y-2">
                                <span id="ai-breakout-badge"
                                    class="text-[9px] font-bold px-1.5 py-0.5 rounded bg-gray-800 text-gray-400">WAITING</span>
                                <p id="ai-breakout-reason" class="text-xs text-gray-400 leading-relaxed italic">
                                    Analyzing price velocity...</p>
                            </div>
                            <div class="p-5 space-y-2">
                                <span id="ai-regime-badge"
                                    class="text-[9px] font-bold px-1.5 py-0.5 rounded bg-gray-800 text-gray-400">WAITING</span>
                                <p id="ai-regime-reason" class="text-xs text-gray-400 leading-relaxed italic">
                                    Calculating regime metrics...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Fundamental Health -->
                    <div class="glass rounded-2xl overflow-hidden border border-gray-800 hidden" id="fundamentals-card">
                        <div class="p-4 border-b border-gray-800 flex justify-between items-center bg-gray-900/50">
                            <h3 class="font-bold text-sm tracking-tight text-gray-300 uppercase">Fundamental Health</h3>
                            <span id="fund-sector"
                                class="text-[10px] font-bold uppercase tracking-widest text-gray-500">‚Äî</span>
                        </div>
                        <div class="grid grid-cols-4 divide-x divide-gray-800 text-center p-4">
                            <div>
                                <p class="text-[10px] text-gray-500 mb-1">M-CAP</p>
                                <p id="fund-mcap" class="text-sm font-bold">‚Äî</p>
                            </div>
                            <div>
                                <p class="text-[10px] text-gray-500 mb-1">P/E</p>
                                <p id="fund-pe" class="text-sm font-bold">‚Äî</p>
                            </div>
                            <div>
                                <p class="text-[10px] text-gray-500 mb-1">ROE</p>
                                <p id="fund-roe" class="text-sm font-bold">‚Äî</p>
                            </div>
                            <div>
                                <p class="text-[10px] text-gray-500 mb-1">DIV</p>
                                <p id="fund-div" class="text-sm font-bold">‚Äî</p>
                            </div>
                        </div>
                        <div class="px-4 py-3 border-t border-gray-800 flex items-center justify-between text-xs">
                            <div class="flex flex-col"><span class="text-gray-500 text-[9px] uppercase">52W Range</span>
                                <div class="flex items-center gap-2 font-mono"><span id="fund-52l"
                                        class="text-down font-bold">‚Äî</span>
                                    <div class="w-24 h-1 bg-gray-800 rounded-full relative overflow-hidden">
                                        <div id="fund-range-bar" class="h-full bg-blue-600 w-0"></div>
                                    </div><span id="fund-52h" class="text-up font-bold">‚Äî</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Levels Sidebar -->
                <div class="col-span-1 space-y-6">
                    <div class="glass rounded-2xl overflow-hidden">
                        <div class="p-4 border-b border-gray-800 flex justify-between items-center">
                            <h3 class="font-bold text-sm">Structural Levels</h3>
                        </div>
                        <div class="p-4 space-y-6">
                            <div>
                                <p class="text-gray-500 text-[10px] uppercase font-bold tracking-widest px-2 mb-2">
                                    Resistances</p>
                                <div id="resistance-list" class="space-y-2"></div>
                            </div>
                            <div>
                                <p class="text-gray-500 text-[10px] uppercase font-bold tracking-widest px-2 mb-2">
                                    Supports</p>
                                <div id="support-list" class="space-y-2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Global Loading Overlay (Body level for persistence) -->
    <div id="loading-overlay"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[100] hidden flex-col items-center justify-center pointer-events-none">
        <div class="flex flex-col items-center">
            <div class="w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div>
            <p class="text-indigo-400 font-bold mt-4 tracking-[0.2em] animate-pulse text-xs">ANALYZING MARKET VIBRATIONS
            </p>
            <p class="text-gray-500 text-[9px] mt-2 font-mono uppercase">Please wait while we calibrate price action</p>
        </div>
    </div>

    <!-- Signal Explanation Modal -->
    <div id="signal-modal-overlay" class="fixed inset-0 modal-overlay hidden flex items-center justify-center p-4">
        <div class="signal-modal rounded-3xl overflow-hidden animate-in zoom-in-95 duration-200">
            <div class="p-6 border-b border-gray-800 flex justify-between items-center bg-gray-900/40">
                <div class="flex items-center gap-3">
                    <span id="expl-status-icon" class="text-2xl">üü¢</span>
                    <div>
                        <h2 id="expl-title" class="text-xl font-bold text-white uppercase tracking-tight">Signal
                            Analysis</h2>
                        <p id="expl-subtitle" class="text-xs text-gray-400 font-mono uppercase tracking-widest mt-0.5">
                            LOCKED v1.0 Intelligence</p>
                    </div>
                </div>
                <button onclick="document.getElementById('signal-modal-overlay').classList.add('hidden')"
                    class="w-10 h-10 rounded-full flex items-center justify-center hover:bg-gray-800 transition-colors text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>

            <div class="p-6 space-y-6 max-h-[70vh] overflow-y-auto custom-scrollbar">
                <!-- 1. Sector Context -->
                <div class="space-y-2">
                    <div class="flex items-center gap-2 text-indigo-400">
                        <span class="text-sm font-bold uppercase tracking-widest">1Ô∏è‚É£ Sector Context</span>
                    </div>
                    <div class="glass p-4 rounded-2xl border-l-4 border-l-blue-500">
                        <p class="text-xs text-white font-bold mb-1">State: <span id="expl-sector-state"
                                class="text-blue-400">LOADING...</span></p>
                        <ul class="text-[11px] text-gray-400 space-y-1 list-disc list-inside leading-relaxed">
                            <li>Sector is moving up in absolute terms</li>
                            <li>Outperforming the broader market (NIFTY)</li>
                            <li>Relative strength is currently improving</li>
                        </ul>
                    </div>
                </div>

                <!-- 2. Stock Strength -->
                <div class="space-y-2">
                    <div class="flex items-center gap-2 text-indigo-400">
                        <span class="text-sm font-bold uppercase tracking-widest">2Ô∏è‚É£ Stock Strength</span>
                    </div>
                    <div class="glass p-4 rounded-2xl border-l-4 border-l-green-500">
                        <p class="text-xs text-white font-bold mb-1">State: <span id="expl-stock-state"
                                class="text-green-400">ACTIVE</span></p>
                        <ul class="text-[11px] text-gray-400 space-y-1 list-disc list-inside leading-relaxed">
                            <li>Outperforming its own sector benchmark</li>
                            <li>Participation: <span id="expl-vol-ratio" class="text-gray-200 font-mono">1.5x</span>
                                volume expansion</li>
                            <li>Confirmed momentum participation</li>
                        </ul>
                    </div>
                </div>

                <!-- 3. Price Structure -->
                <div class="space-y-2">
                    <div class="flex items-center gap-2 text-indigo-400">
                        <span class="text-sm font-bold uppercase tracking-widest">3Ô∏è‚É£ Price Structure</span>
                    </div>
                    <div class="bg-gray-900/50 p-4 rounded-2xl border border-gray-800 grid grid-cols-2 gap-3">
                        <div class="flex flex-col">
                            <span class="text-[9px] text-gray-500 uppercase font-bold">VWAP Bias</span>
                            <span id="expl-vwap" class="text-xs font-bold text-white">Above VWAP</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-[9px] text-gray-500 uppercase font-bold">Breakout</span>
                            <span id="expl-breakout" class="text-xs font-bold text-white">Confirmed</span>
                        </div>
                    </div>
                </div>

                <!-- 4. Session Timing -->
                <div class="space-y-2">
                    <div class="flex items-center gap-2 text-indigo-400">
                        <span class="text-sm font-bold uppercase tracking-widest">4Ô∏è‚É£ Session Timing</span>
                    </div>
                    <div class="glass p-4 rounded-2xl border-l-4 border-l-purple-500">
                        <p class="text-xs text-white font-bold mb-1">Quality: <span id="expl-session-quality"
                                class="text-purple-400">BEST</span></p>
                        <p class="text-[11px] text-gray-400 leading-relaxed italic">Lower noise floor and higher
                            breakout follow-through during the mid-session window.</p>
                    </div>
                </div>

                <!-- 5. Risk Guidance -->
                <div class="space-y-2">
                    <div class="flex items-center gap-2 text-indigo-400">
                        <span class="text-sm font-bold uppercase tracking-widest">5Ô∏è‚É£ Risk Classification</span>
                    </div>
                    <div class="bg-indigo-600/10 border border-indigo-500/20 p-4 rounded-2xl text-center">
                        <p id="expl-ru" class="text-2xl font-bold text-indigo-400 mb-1">1.5 RU</p>
                        <p class="text-[10px] text-gray-400 uppercase tracking-widest">Suggested Risk Units</p>
                        <p class="text-[10px] text-gray-500 mt-2 italic px-4">RU is a relative risk unit. Choose your
                            own capital per RU.</p>
                    </div>
                </div>

                <!-- Confidence Breakdown -->
                <div id="expl-confidence-breakdown-section" class="space-y-2">
                    <div class="flex items-center gap-2 text-indigo-400">
                        <span class="text-sm font-bold uppercase tracking-widest">üìä Why this confidence?</span>
                    </div>
                    <div class="bg-gray-900/40 border border-gray-800 p-4 rounded-2xl">
                        <ul id="expl-confidence-list" class="text-[11px] space-y-2 font-medium">
                            <li class="flex items-center justify-between">
                                <span class="text-gray-400">Sector Strength</span>
                                <span class="text-green-400">+30%</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Invalidation Rules (CRITICAL FOR TRUST) -->
                <div class="p-5 bg-red-600/5 border border-red-500/20 rounded-2xl">
                    <h3 class="text-xs font-bold text-red-400 uppercase mb-3 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                clip-rule="evenodd"></path>
                        </svg>
                        What would invalidate this signal?
                    </h3>
                    <ul class="text-[11px] text-gray-500 space-y-2 list-none font-medium">
                        <li class="flex items-center gap-2">‚ùå <span id="inv-sector">Sector weakens (moves to WEAKENING
                                or LAGGING)</span></li>
                        <li class="flex items-center gap-2">‚ùå <span id="inv-price">Price falls below VWAP</span></li>
                        <li class="flex items-center gap-2">‚ùå <span id="inv-volume">Volume dries up (below normal
                                levels)</span></li>
                        <li class="flex items-center gap-2">‚ùå <span id="inv-session">Session shifts to late / closing
                                phase</span></li>
                        <li class="flex items-center gap-2">‚ùå <span id="inv-market">Market conditions change
                                sharply</span></li>
                    </ul>
                    <p class="text-[10px] text-gray-600 mt-4 italic font-bold uppercase tracking-tighter">If any
                        happens, signal automatically downgrades to WAIT or AVOID.</p>
                </div>
            </div>

            <div class="p-6 bg-gray-900/40 border-t border-gray-800">
                <p id="expl-summary" class="text-xs text-gray-300 leading-relaxed italic text-center">‚ÄúThis stock is
                    aligned with a strong sector, showing relative strength and high participation.‚Äù</p>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="rotation.js"></script>
    <script src="dashboard.js"></script>
    <script src="intelligence_ux.js"></script>
</body>

</html>